# One-time Secrets API

–°–µ—Ä–≤–∏—Å –¥–ª—è **–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤**.  
–†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ FastAPI + PostgreSQL + Redis. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ ‚Äî –∫–∞–∫ Pastebin, –Ω–æ —Å –∞–≤—Ç–æ–∑–∞—á–∏—Å—Ç–∫–æ–π –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º.

## ‚öôÔ∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- üêç Python 3.10
- üöÄ FastAPI
- üêò PostgreSQL
- üî• Redis
- üê≥ Docker + Docker Compose
- üîê Alembic (–º–∏–≥—Ä–∞—Ü–∏–∏)
- üîÅ TTL-—á–µ–∫–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞—á–∏—Å—Ç–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞


```bash
    One-time-secrets/
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îú‚îÄ‚îÄ alembic/               # –ö–∞—Ç–∞–ª–æ–≥ –º–∏–≥—Ä–∞—Ü–∏–π Alembic
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ versions/          # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ env.py             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ script.py.mako     # –®–∞–±–ª–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–π
    ‚îÇ   ‚îú‚îÄ‚îÄ api/                   # API —Ä–æ—É—Ç—ã FastAPI
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routers.py
    ‚îÇ   ‚îú‚îÄ‚îÄ db/                    # –†–∞–±–æ—Ç–∞ —Å –ë–î (–º–æ–¥–µ–ª–∏, CRUD, –∫–æ–Ω—Ñ–∏–≥)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config_db.py
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ crud.py
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py
    ‚îÇ   ‚îú‚îÄ‚îÄ redis/                 # Redis-–∫–ª–∏–µ–Ω—Ç –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ crypto.py
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redis_client.py
    ‚îÇ   ‚îú‚îÄ‚îÄ schemas/               # Pydantic-—Å—Ö–µ–º—ã
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ secrets.py
    ‚îÇ   ‚îú‚îÄ‚îÄ tasks/                 # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ttl_checker.py     # –ß–µ–∫–µ—Ä –¥–ª—è TTL-—Å–µ–∫—Ä–µ—Ç–æ–≤
    ‚îÇ   ‚îú‚îÄ‚îÄ main.py                # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    ‚îÇ   ‚îî‚îÄ‚îÄ middleware.py          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ middleware
    ‚îú‚îÄ‚îÄ .dockerignore              # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Docker
    ‚îú‚îÄ‚îÄ .env                       # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≤ .gitignore)
    ‚îú‚îÄ‚îÄ .gitignore                 # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Git
    ‚îú‚îÄ‚îÄ alembic.ini                # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Alembic
    ‚îú‚îÄ‚îÄ docker-compose.yml         # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ Dockerfile                 # Dockerfile –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞
    ‚îú‚îÄ‚îÄ README.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–í–´ –¢–£–¢)
    ‚îú‚îÄ‚îÄ requirements.txt           # Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    ‚îî‚îÄ‚îÄ start.sh                   # –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–æ–ø—Ü.)
````




## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

> üí° –£–±–µ–¥–∏—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω **Docker** –∏ **docker-compose**.

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/your-user/your-repo.git
cd your-repo

# –°–æ–∑–¥–∞–π —Ñ–∞–π–ª –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env  # –Ω–∞—Å—Ç—Ä–æ–π –µ–≥–æ –ø–æ –æ–±—Ä–∞–∑—Ü—É

# –°–æ–±–µ—Ä–∏ –∏ –∑–∞–ø—É—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç
docker-compose up --build
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000 .

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger: http://localhost:8000/docs

---

üõ† –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:

```env

    POSTGRES_USER=postgres
    POSTGRES_PASSWORD=postgres
    POSTGRES_DB=one_time_secrets
    POSTGRES_HOST=postgres
    POSTGRES_PORT=5432
    
    REDIS_HOST=redis
    REDIS_PORT=6379
    
    SECRET_KEY=some-super-secret-key
    ENCRYPTION_KEY=32-bytes-key-in-base64
```
---

## üì° –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã API

POST /secrets/ ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç:

```json
    {
      "secret": "my super top secret",
      "ttl": 3600 // –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    }
```
**–û—Ç–≤–µ—Ç:**

```json
    {
      "id": "a1b2c3d4"
    }
```
GET /secrets/{id} ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å:

```json
    {
      "secret": "my super top secret"
    }
```
---